(function(e){var t,n=function(){return t||window.event},r=function(e){t=e};if(navigator.userAgent.toLowerCase().indexOf("firefox")>=0){window.addEventListener("mousedown",r,true)}e.fn.extend({detectDrag:function(){var t=false,r=null,i=null,s=null,o={set:function(e){o=e}},u=null,a=function(e){e.preventDefault();return false},f=function(e){return Math.abs(r.x-e.clientX)>5||Math.abs(r.y-e.clientY)>5},l=function(n){t=true;i=s.clone().css({position:"absolute",translateX:n.clientX+5,translateY:n.clientY+5}).appendTo("body");e("input, textarea").blur();s.trigger("dragstart",[o,i,s])},c=function(t){var n=e(t.target),r=n[0]!==(u?u[0]:null);if(n.attr("dropable")&&r){u=n;n.trigger("dragenter",[i,s])}else if(u&&r){u.trigger("dragleave",[i,s]);u=null}i.css({left:t.clientX+5,top:t.clientY+5})},h=function(e){if(t){c(e)}else if(f(e)){l(e)}},p=function(n){var r=e(n.target),u=e(window);if(t){i.remove();if(r.attr("dropable")){r.trigger("drop",[o,i,s])}else{s.trigger("dragend",[i,s])}}t=false;s.off("selectstart",a);e("body").css("user-select","auto");u.off("mousemove",h).off("mouseup",p)};r={x:n().clientX,y:n().clientY};s=e(this);s.on("selectstart",a);e("body").css("user-select","none");e(window).on("mousemove",h).on("mouseup",p)}})})(jQuery)